# Настройка GPT Actions для Exply.dev API

## Выбор типа авторизации в ChatGPT

### Рекомендация: **"API Key"** (не OAuth)

**Почему API Key, а не OAuth:**
- OAuth требует интерактивный flow (redirect → login → callback), который сложно настроить в GPT Actions
- API Key проще для пользователей
- Поддерживает fallback через `githubUsername` параметр

### Варианты настройки

#### Вариант 1: Без авторизации (для публичного GPT - рекомендуемый)

**Настройка в GPT Actions:**
1. Загрузите OpenAPI схему: `https://raw.githubusercontent.com/exply-dev/exply-dev-public-docs/main/api/exply-project-proposals-api.json`
   - **Примечание:** Если видите старую версию в браузере (с `schemas: {}`), это кэш GitHub CDN. Подождите 5-10 минут или используйте прямой URL через GitHub API:
     `https://api.github.com/repos/exply-dev/exply-dev-public-docs/contents/api/exply-project-proposals-api.json` (нужно декодировать base64 из поля `content`)
2. В разделе "Аутентификация" выберите: **"Ничего" (Nothing)**
3. Сохраните

**Важно:** Если GPT показывает предупреждение о security scheme, игнорируйте его - схема поддерживает работу без авторизации через параметр `githubUsername`.

**Как работает:**
- ✅ Создание ресурсов работает без токена (агент спрашивает `githubUsername`)
- ✅ Обновление работает через параметр `githubUsername` в body запроса
- ✅ Пользователю не нужно ничего настраивать
- ⚠️ Менее безопасно (username можно подделать, но проверяется существование)

**Использование:**
- Агент спрашивает GitHub username при создании
- При обновлении передает `githubUsername` в параметрах запроса

#### Вариант 2: API Key (если хотите использовать токены)

**Настройка в GPT Actions:**
1. Загрузите OpenAPI схему
2. В разделе "Аутентификация" выберите: **"API Key"**
3. **Auth Type:** `Custom`
4. **Header Name:** `Authorization`
5. **API Key:** Оставьте пустым (пользователь введет свой токен при первом использовании)

**Как работает:**
- ✅ Более безопасно (токен проверяется через GitHub API)
- ✅ Нельзя подделать
- ❌ Каждый пользователь должен создать свой GitHub PAT и ввести его в GPT
- ❌ Требует от пользователей технических знаний

**Использование:**
- Пользователь создает GitHub PAT: https://github.com/settings/tokens
- Вводит токен в GPT Actions (при первом вызове API)
- GPT автоматически добавляет `Authorization: Bearer ghp_...` в заголовки

#### Вариант 3: OAuth (не рекомендуется для GPT Actions)

**Почему не рекомендуется:**
- Требует настройки GitHub App
- Интерактивный flow сложен для GPT Actions
- Пользователю нужно авторизоваться в браузере каждый раз

## Текущая реализация API

### Endpoints с поддержкой обоих методов:

**`/update_project_issue`:**
- **Security:** `[{ "apiKey": [] }, {}]` - принимает либо токен, либо без авторизации
- Если токен в header → использует его для проверки
- Если нет токена → требует `githubUsername` в body

**`/create_expert_profile`:**
- **Security:** `[{}, { "apiKey": [] }]` - опциональная авторизация
- При создании: опционально
- При обновлении: требуется токен или `githubUsername`

**`/create_project_issue`:**
- **Security:** `[{}, { "apiKey": [] }]` - опциональная авторизация
- Рекомендуется передавать `githubUsername` для будущих обновлений

## Рекомендация для публичного GPT

**Выбрать: "Ничего" (Nothing)** в настройках авторизации GPT Actions.

**Причины:**
1. ✅ Проще для пользователей (не нужен токен)
2. ✅ Работает сразу без настройки
3. ✅ Используется fallback через `githubUsername`
4. ✅ Агент спрашивает username автоматически

**Ограничения:**
- Менее безопасно, чем token (но username проверяется через GitHub API)
- Для критичных операций можно позже добавить обязательную авторизацию

## Проверка работы

После настройки проверьте:
1. ✅ GPT загрузил схему без ошибок
2. ✅ Endpoints видны в списке Actions
3. ✅ Создание проекта работает без ошибок
4. ✅ При создании агент спрашивает GitHub username

## Troubleshooting

**Ошибка: "Authentication required"**
- Проверьте, что передаете `githubUsername` в body запроса
- Или настройте API Key с GitHub PAT

**Ошибка: "You don't have permission"**
- Проверьте, что username совпадает с creator метаданными
- Создатель указан в скрытом комментарии: `<!-- Creator: username -->`

